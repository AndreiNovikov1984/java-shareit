DROP TABLE IF EXISTS USERS cascade;
DROP TABLE IF EXISTS ITEMS cascade;
DROP TABLE IF EXISTS BOOKINGS cascade;
DROP TABLE IF EXISTS COMMENTS cascade;
DROP TABLE IF EXISTS REQUEST cascade;

create table IF NOT EXISTS USERS
(
    ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL
        primary key,
    USER_NAME  CHARACTER VARYING(50)  not null,
    USER_EMAIL CHARACTER VARYING(100) not null
        unique
);

create table IF NOT EXISTS ITEMS
(
    ID     BIGINT GENERATED BY DEFAULT AS IDENTITY primary key,
    ITEM_NAME CHARACTER VARYING(100) not null,
    DESCRIPTION CHARACTER VARYING(500) not null,
    AVAILABLE   BOOLEAN                not null,
    OWNER_ID    BIGINT not null REFERENCES USERS (id) ON DELETE CASCADE,
    REQUEST_ID     INTEGER
);

create table IF NOT EXISTS BOOKINGS
(
    ID BIGINT GENERATED BY DEFAULT AS IDENTITY
        primary key,
    START_DATE TIMESTAMP not null,
    END_DATE   TIMESTAMP not null,
    ITEM_ID    BIGINT      not null REFERENCES ITEMS (id) ON DELETE CASCADE,
    BOOKER_ID  BIGINT      not null REFERENCES USERS (id) ON DELETE CASCADE,
    STATUS CHARACTER VARYING(10)
);

create table IF NOT EXISTS REQUEST
(
    ID   BIGINT GENERATED BY DEFAULT AS IDENTITY primary key,
    DESCRIPTION  CHARACTER VARYING(1000) not null,
    REQUESTOR_ID BIGINT                    not null REFERENCES USERS (id) ON DELETE CASCADE,
    CREATED    TIMESTAMP                not null
);

create table IF NOT EXISTS COMMENTS
(
    ID BIGINT GENERATED BY DEFAULT AS IDENTITY primary key,
    TEXT       CHARACTER VARYING(1000) not null,
    ITEM_ID    BIGINT                    not null REFERENCES ITEMS (id) ON DELETE CASCADE,
    AUTHOR_ID  BIGINT                    not null REFERENCES USERS (id) ON DELETE CASCADE,
    CREATED    TIMESTAMP                not null
);
